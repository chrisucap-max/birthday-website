<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üîí Riya Answers</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    .wrap{ max-width:760px; margin:18px auto; background:#fff; border-radius:14px; padding:16px; box-shadow:0 6px 16px rgba(0,0,0,.08); }
    .q{ margin:10px 0; text-align:left; }
    .q h3{ margin:0 0 8px; font-size:18px; }
    .opt{ margin:4px 0; }
    .gate{ max-width:480px; margin: 14px auto; background:#fff; padding:14px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.1); }
    .btn{ background:#ff4081; color:#fff; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; }
    .err{ color:#e53935; font-weight:700; margin-top:8px; }
    .ok{ color:#2e7d32; font-weight:700; margin-top:8px; }
  </style>
</head>
<body>
  <header>
    <h1>üîí Riya Answers</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="quiz.html">Quiz</a>
    </nav>
  </header>

  <!-- Simple gate so only Riya can access -->
  <section class="gate" id="gate">
    <p>Riya, enter your secret code:</p>
    <input id="code" placeholder="Secret code" style="padding:10px 12px; border:2px solid #ddd; border-radius:8px; width:100%;">
    <div style="margin-top:10px;">
      <button id="enterBtn" class="btn">Enter</button>
    </div>
    <div id="gateMsg" class="err" style="display:none;"></div>
  </section>

  <!-- Answers UI -->
  <section class="wrap" id="riyaBox" style="display:none;">
    <h2>Mark your answers</h2>
    <div id="qs"></div>
    <div style="margin-top:12px;">
      <button id="saveBtn" class="btn">üíæ Save All</button>
    </div>
    <p id="status"></p>
  </section>

  <footer>Made with ‚ù§Ô∏è for Riya</footer>

  <script>
    // üîê Change this before sharing with Riya
    const SECRET_CODE = "RIYA-2025";

    // Supabase
    const SUPABASE_URL = "https://tbvrpaubtluwjuylduiz.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRidnJwYXVidGx1d2p1eWxkdWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzMzAxOTUsImV4cCI6MjA3MTkwNjE5NX0.LiS7f23l9mm7Xp7xWHQH0ZM1K4rRxNrwQopqlntawcI";

    // ‚úÖ Important: use window.supabase
    const supa = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // MUST MATCH quiz.html
    const quizData = [
      { q: "üíñ Who is Riya‚Äôs celebrity crush?", opts: ["Chris Hemsworth","Chris Evans","Shah Rukh Khan","Harry Styles"] },
      { q: "üç´ What sweet does Riya absolutely love?", opts: ["Ferrero Rocher","Kinder Joy","Laddu","Brownies"] },
      { q: "üå∏ How would you best describe Riya?", opts: ["Joyful","Serious","Sleepy","Grumpy"] },
      { q: "üéÇ When is Riya‚Äôs birthday?", opts: ["Aug 15","Sep 2","Oct 10","Jan 1"] },
      { q: "üé¨ What kind of movies does Riya vibe with most?", opts: ["Action","Rom-com","Horror","Documentary"] }
    ];

    const gate = document.getElementById("gate");
    const gateMsg = document.getElementById("gateMsg");
    const riyaBox = document.getElementById("riyaBox");
    const qsEl = document.getElementById("qs");
    const statusEl = document.getElementById("status");

    document.getElementById("enterBtn").onclick = () => {
      const c = (document.getElementById("code").value || "").trim();
      if(c === SECRET_CODE){
        gate.style.display = "none";
        riyaBox.style.display = "block";
        gateMsg.style.display = "none";
        renderQs();
        preloadExisting();
      } else {
        gateMsg.textContent = "Wrong code.";
        gateMsg.style.display = "block";
      }
    };

    function renderQs(){
      qsEl.innerHTML = "";
      quizData.forEach((item, i) => {
        const div = document.createElement("div");
        div.className = "q";
        div.innerHTML = `<h3>Q${i+1}. ${item.q}</h3>`;
        item.opts.forEach((o, idx) => {
          const id = `q_${i}_${idx}`;
          const row = document.createElement("div");
          row.className = "opt";
          row.innerHTML = `
            <label for="${id}">
              <input type="radio" name="riya_${i}" id="${id}" value="${idx}"> ${o}
            </label>`;
          div.appendChild(row);
        });
        qsEl.appendChild(div);
      });
    }

    async function preloadExisting(){
      statusEl.textContent = "Loading existing answers‚Ä¶";
      statusEl.className = "";
      const { data, error } = await supa.from("riya_answers").select("q_index,choice_index");
      if(error){
        console.error("Load error:", error);
        statusEl.textContent = "Could not load existing answers: " + error.message;
        statusEl.className = "err";
        return;
      }
      data.forEach(r => {
        const el = document.querySelector(`input[name="riya_${r.q_index}"][value="${r.choice_index}"]`);
        if(el) el.checked = true;
      });
      statusEl.textContent = "Ready.";
      statusEl.className = "ok";
      setTimeout(()=>{ statusEl.textContent=""; statusEl.className=""; }, 1200);
    }

    document.getElementById("saveBtn").onclick = async () => {
      statusEl.textContent = "Saving‚Ä¶";
      statusEl.className = "";

      const rows = [];
      quizData.forEach((_, i) => {
        const sel = document.querySelector(`input[name="riya_${i}"]:checked`);
        if(sel) rows.push({ q_index: i, choice_index: parseInt(sel.value, 10) });
      });

      if(rows.length === 0){
        statusEl.textContent = "Please select at least one answer.";
        statusEl.className = "err";
        return;
      }

      // ‚úÖ Upsert on primary key q_index, and return rows so we can confirm
      const { data, error } = await supa
        .from("riya_answers")
        .upsert(rows, { onConflict: "q_index" })
        .select();

      if(error){
        console.error("Save error:", error);
        statusEl.textContent = "Save failed: " + error.message;
        statusEl.className = "err";
        return;
      }

      console.log("Saved:", data);
      statusEl.textContent = "Saved! üéâ";
      statusEl.className = "ok";
    };
  </script>
</body>
</html>
