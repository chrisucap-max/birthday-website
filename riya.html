<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🔐 Riya — Set Correct Answers</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    .wrap{ max-width: 860px; margin: 18px auto; padding: 16px; }
    .card{ background:#fff; border-radius:14px; padding:16px; box-shadow:0 6px 16px rgba(0,0,0,.08); }
    .q{ margin:12px 0; }
    .q h4{ margin:6px 0 8px; font-size:16px; }
    .opt{ display:block; margin:6px 0; }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .btn{ background:#ff4081; color:#fff; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; }
    .btn.secondary{ background:#6c63ff; }
    .tiny{ color:#666; font-size:12px; }
    #gate{ text-align:center; }
    header nav a[href="riya.html"]{ font-weight:800; }
  </style>
</head>
<body>
<header>
  <h1>🔐 Riya — Set Correct Answers</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="wishes.html">Wishes</a>
    <a href="memories.html">Memories</a>
    <a href="quiz.html">Quiz</a>
    <a href="leaderboard.html">Leaderboard</a>
    <a href="riya.html">Riya Admin</a>
  </nav>
</header>

<section class="wrap">
  <!-- Access gate -->
  <div id="gate" class="card">
    <p><b>Enter PIN to edit answers:</b></p>
    <input id="pinInput" type="password" placeholder="PIN" style="padding:8px 10px;border:2px solid #ddd;border-radius:8px">
    <button id="pinBtn" class="btn">Unlock</button>
    <p class="tiny">Default PIN is <code>RIYA2025</code> — change it in the code.</p>
    <div id="pinMsg" class="tiny"></div>
  </div>

  <!-- Form -->
  <div id="formCard" class="card" style="display:none;">
    <div class="row">
      <button id="saveAll" class="btn">💾 Save All</button>
      <button id="reload" class="btn secondary">🔄 Reload Saved</button>
      <span id="status" class="tiny">—</span>
    </div>
    <hr>

    <div id="formWrap"></div>
    <hr>
    <div class="tiny" id="missingInfo">—</div>
  </div>
</section>

<footer>Made with ❤️ for Riya</footer>

<script>
  // CONFIG
  const PIN = "RIYA2025"; // change if you want
  const SUPABASE_URL = "https://tbvrpaubtluwjuylduiz.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRidnJwYXVidGx1d2p1eWxkdWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzMzAxOTUsImV4cCI6MjA3MTkwNjE5NX0.LiS7f23l9mm7Xp7xWHQH0ZM1K4rRxNrwQopqlntawcI";
  const supa = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // Questions MUST match quiz.html
  const quizData = [
    { q: "🛒 If Riya goes shopping for 'just one thing,' what will actually happen?", opts: ["Buys only that","Buys 3–4 extras","Ends up with a whole bag","Forgets the main item"] },
    { q: "🎨 What is Riya’s favourite colour?", opts: ["Black","Pink","Blue","Yellow"] },
    { q: "📚 What was Riya’s favourite subject in school?", opts: ["History","Literature","Science","Art"] },
    { q: "🍴 What is Riya’s favourite food?", opts: ["Pizza","Momos","Tiger prawns","Ice cream"] },
    { q: "🎶 Which artist or band is Riya’s favourite?", opts: ["BTS","Arijit Singh","Taylor Swift","Coldplay"] },
    { q: "✨ What is Riya’s hidden talent?", opts: ["Singing","Cooking","Drawing","Dancing"] },
    { q: "🚗 What is Riya’s favourite car?", opts: ["Mercedes","Mini Cooper","Scorpio","Jeep"] },
    { q: "🛌 What time does Riya usually go to sleep?", opts: ["Before midnight","Around 1–2am","3–4am","Depends on Netflix"] },
    { q: "🌸 What is Riya’s ideal way to relax after a stressful day?", opts: ["Watch Netflix","Listen to music","Sleep instantly","Go for a walk"] },
    { q: "🛍️ What’s the last thing Riya impulse-bought online?", opts: ["Clothes","Skincare","Phone case","Snacks"] },
    { q: "⏰ Is Riya a morning person or a night owl?", opts: ["Morning person","Both","Night owl","Neither"] }
  ];
  const N = quizData.length;

  // Elements
  const gate = document.getElementById('gate');
  const pinInput = document.getElementById('pinInput');
  const pinBtn = document.getElementById('pinBtn');
  const pinMsg = document.getElementById('pinMsg');

  const formCard = document.getElementById('formCard');
  const formWrap = document.getElementById('formWrap');
  const saveAll = document.getElementById('saveAll');
  const reloadBtn = document.getElementById('reload');
  const statusEl = document.getElementById('status');
  const missingInfo = document.getElementById('missingInfo');

  pinBtn.onclick = ()=>{
    if((pinInput.value||"").trim() === PIN){
      gate.style.display = 'none';
      formCard.style.display = 'block';
      buildForm();
      loadSaved();
    }else{
      pinMsg.textContent = "❌ Incorrect PIN";
    }
  };

  function buildForm(){
    formWrap.innerHTML = "";
    quizData.forEach((q, qi)=>{
      const div = document.createElement('div');
      div.className = "q";
      const title = document.createElement('h4');
      title.textContent = `${qi+1}. ${q.q}`;
      div.appendChild(title);

      q.opts.forEach((o, oi)=>{
        const lab = document.createElement('label');
        lab.className = "opt";
        const rb = document.createElement('input');
        rb.type = "radio"; rb.name = "q"+qi; rb.value = oi;
        lab.appendChild(rb);
        lab.appendChild(document.createTextNode(" " + o));
        div.appendChild(lab);
      });

      formWrap.appendChild(div);
      const hr = document.createElement('hr');
      hr.style.border = "none"; hr.style.borderTop = "1px solid #eee";
      formWrap.appendChild(hr);
    });
  }

  // Load current saved correct answers
  async function loadSaved(){
    statusEl.textContent = "Loading saved answers…";
    const { data, error } = await supa.from('riya_answers').select('q_index, choice_index');
    if(error){ statusEl.textContent = "Error: " + error.message; return; }

    const map = new Map(data.map(d => [d.q_index, d.choice_index]));
    for(let i=0;i<N;i++){
      const idx = map.get(i);
      if(idx != null){
        const rb = document.querySelector(`input[name="q${i}"][value="${idx}"]`);
        if(rb) rb.checked = true;
      }
    }
    updateMissing();
    statusEl.textContent = "Loaded.";
  }

  function updateMissing(){
    const selected = [...Array(N).keys()].filter(i => document.querySelector(`input[name="q${i}"]:checked`));
    const missing = N - selected.length;
    if(missing === 0) missingInfo.textContent = "✅ All answers selected.";
    else missingInfo.textContent = `⏳ ${missing} question(s) not selected yet.`;
  }

  // Save all answers (upsert)
  saveAll.onclick = async ()=>{
    const rows = [];
    for(let i=0;i<N;i++){
      const rb = document.querySelector(`input[name="q${i}"]:checked`);
      if(rb) rows.push({ q_index: i, choice_index: parseInt(rb.value,10) });
    }
    if(rows.length === 0){ alert("Pick at least one answer."); return; }

    statusEl.textContent = "Saving…";
    try{
      for(const r of rows){
        const { error } = await supa.from('riya_answers').upsert(r, { onConflict: 'q_index' });
        if(error) throw error;
      }
      statusEl.textContent = "✅ Saved!";
      updateMissing();
    }catch(err){
      console.error(err);
      statusEl.textContent = "❌ Save failed: " + err.message;
    }
  };

  reloadBtn.onclick = loadSaved;

  formWrap.addEventListener('change', (e)=>{
    if(e.target && e.target.type === 'radio'){
      updateMissing();
    }
  });
</script>
</body>
</html>
